# "å»å¹´ä»Šæ—¥"åŠŸèƒ½è°ƒç ”æŠ¥å‘Š

## ä¸€ã€åŠŸèƒ½è®¾è®¡

### 1.1 æ ¸å¿ƒåŠŸèƒ½å®šä¹‰

**"å»å¹´ä»Šæ—¥"ï¼ˆOn This Dayï¼‰** åŠŸèƒ½æ˜¯æŒ‡ï¼š
- æ˜¾ç¤ºç”¨æˆ·åœ¨**è¿‡å»åŒä¸€å¤©**ï¼ˆæˆ–åŒæœˆåŒæ—¥ï¼‰åˆ›å»ºçš„æ‰‹è®°æ¡ç›®
- æ”¯æŒæŸ¥çœ‹å¤šå¹´å†å²ï¼ˆå»å¹´ã€å‰å¹´ã€Nå¹´å‰ï¼‰
- å¸®åŠ©ç”¨æˆ·å›é¡¾å’Œå¯¹æ¯”ä¸åŒå¹´ä»½çš„åŒä¸€æ—¶æœŸ

### 1.2 åŠŸèƒ½åœºæ™¯

#### åœºæ™¯1ï¼šæ—¥å¸¸å›é¡¾
- ç”¨æˆ·æ‰“å¼€æ‰‹è®°è§†å›¾ï¼Œçœ‹åˆ°"å»å¹´ä»Šæ—¥"å¡ç‰‡
- æ˜¾ç¤ºå»å¹´åŒä¸€å¤©çš„æ‰‹è®°å†…å®¹
- ç‚¹å‡»å¯æŸ¥çœ‹è¯¦æƒ…

#### åœºæ™¯2ï¼šå¤šå¹´å¯¹æ¯”
- æ˜¾ç¤º"2å¹´å‰ä»Šæ—¥"ã€"3å¹´å‰ä»Šæ—¥"ç­‰å¤šä¸ªæ—¶é—´ç‚¹
- ç”¨æˆ·å¯ä»¥å¯¹æ¯”ä¸åŒå¹´ä»½çš„åŒä¸€æ—¶æœŸ

#### åœºæ™¯3ï¼šæƒ…æ„Ÿå…±é¸£
- çœ‹åˆ°è¿‡å»çš„ç¾å¥½å›å¿†
- å¯¹æ¯”æˆé•¿å’Œå˜åŒ–

### 1.3 æ•°æ®åŒ¹é…é€»è¾‘

#### åŒ¹é…è§„åˆ™
1. **ç²¾ç¡®åŒ¹é…**ï¼ˆæ¨èï¼‰
   - åŒ¹é…åŒæœˆåŒæ—¥ï¼ˆå¿½ç•¥å¹´ä»½ï¼‰
   - ä¾‹å¦‚ï¼š2026-01-12 åŒ¹é… 2025-01-12, 2024-01-12, ...

2. **èŒƒå›´åŒ¹é…**ï¼ˆå¯é€‰ï¼‰
   - åŒ¹é…å‰åNå¤©ï¼ˆå¦‚Â±3å¤©ï¼‰
   - é€‚ç”¨äºç”¨æˆ·å¯èƒ½è®°é”™æ—¥æœŸçš„æƒ…å†µ

3. **æ—¶é—´èŒƒå›´**
   - é»˜è®¤æ˜¾ç¤ºï¼š1å¹´å‰ã€2å¹´å‰ã€3å¹´å‰ï¼ˆæœ€å¤š3å¹´ï¼‰
   - å¯é…ç½®ï¼šç”¨æˆ·é€‰æ‹©æ˜¾ç¤ºå¤šå°‘å¹´çš„å†å²

#### æ•°æ®ç­›é€‰
- åªæ˜¾ç¤ºæœ‰å†…å®¹çš„æ¡ç›®ï¼ˆæ’é™¤ç©ºæ–‡ä»¶ï¼‰
- æŒ‰æ—¶é—´å€’åºæ’åˆ—ï¼ˆæœ€æ–°çš„å¹´ä»½åœ¨å‰ï¼‰
- é™åˆ¶æ˜¾ç¤ºæ•°é‡ï¼ˆå¦‚æ¯ä¸ªå¹´ä»½æœ€å¤šæ˜¾ç¤º5æ¡ï¼‰

### 1.4 åŠŸèƒ½é…ç½®

#### ç”¨æˆ·å¯é…ç½®é¡¹
1. **å¯ç”¨/ç¦ç”¨**ï¼šæ˜¯å¦æ˜¾ç¤º"å»å¹´ä»Šæ—¥"åŠŸèƒ½
2. **æ˜¾ç¤ºå¹´é™**ï¼šæ˜¾ç¤ºå¤šå°‘å¹´çš„å†å²ï¼ˆ1-10å¹´ï¼‰
3. **åŒ¹é…ç²¾åº¦**ï¼šç²¾ç¡®åŒ¹é… vs èŒƒå›´åŒ¹é…
4. **æ˜¾ç¤ºæ•°é‡**ï¼šæ¯ä¸ªå¹´ä»½æœ€å¤šæ˜¾ç¤ºå¤šå°‘æ¡
5. **è‡ªåŠ¨å±•å¼€**ï¼šæ˜¯å¦é»˜è®¤å±•å¼€æ‰€æœ‰å¹´ä»½

---

## äºŒã€UIè®¾è®¡

### 2.1 å±•ç¤ºä½ç½®

#### æ–¹æ¡ˆAï¼šç‹¬ç«‹åŒºåŸŸï¼ˆæ¨èï¼‰
- ä½ç½®ï¼šåœ¨ç»Ÿè®¡ä¿¡æ¯ä¸‹æ–¹ï¼Œæ‰‹è®°åˆ—è¡¨ä¸Šæ–¹
- ä¼˜ç‚¹ï¼šç‹¬ç«‹å±•ç¤ºï¼Œä¸å¹²æ‰°ä¸»åˆ—è¡¨
- ç¼ºç‚¹ï¼šå ç”¨å‚ç›´ç©ºé—´

#### æ–¹æ¡ˆBï¼šä¾§è¾¹æ 
- ä½ç½®ï¼šå³ä¾§å›ºå®šä¾§è¾¹æ 
- ä¼˜ç‚¹ï¼šä¸å ç”¨ä¸»å†…å®¹åŒº
- ç¼ºç‚¹ï¼šç§»åŠ¨ç«¯ä½“éªŒå·®

#### æ–¹æ¡ˆCï¼šå¼¹çª—/æ¨¡æ€æ¡†
- ä½ç½®ï¼šç‚¹å‡»æŒ‰é’®åå¼¹å‡º
- ä¼˜ç‚¹ï¼šä¸å ç”¨ç©ºé—´
- ç¼ºç‚¹ï¼šéœ€è¦é¢å¤–æ“ä½œ

**æ¨èï¼šæ–¹æ¡ˆA** - ç‹¬ç«‹åŒºåŸŸå±•ç¤º

### 2.2 è§†è§‰è®¾è®¡

#### å¡ç‰‡è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“… å»å¹´ä»Šæ—¥ (2025å¹´1æœˆ12æ—¥)        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  [å›¾ç‰‡] æ ‡é¢˜                        â”‚
â”‚  å†…å®¹é¢„è§ˆ...                        â”‚
â”‚  2025å¹´1æœˆ12æ—¥                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è®¾è®¡è¦ç‚¹
1. **æ—¶é—´æ ‡ç­¾**
   - æ˜¾ç¤º"Xå¹´å‰ä»Šæ—¥"
   - ä½¿ç”¨ä¸åŒé¢œè‰²åŒºåˆ†å¹´ä»½ï¼ˆ1å¹´å‰ï¼šè“è‰²ï¼Œ2å¹´å‰ï¼šç»¿è‰²ï¼Œ3å¹´å‰ï¼šæ©™è‰²ï¼‰
   - å›¾æ ‡ï¼šæ—¥å†æˆ–æ—¶é’Ÿå›¾æ ‡

2. **å¡ç‰‡æ ·å¼**
   - ä¸ä¸»åˆ—è¡¨å¡ç‰‡ä¿æŒä¸€è‡´çš„è®¾è®¡è¯­è¨€
   - æ·»åŠ ç‰¹æ®Šè¾¹æ¡†æˆ–èƒŒæ™¯è‰²ä»¥ç¤ºåŒºåˆ«
   - æ”¯æŒç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…

3. **ç©ºçŠ¶æ€**
   - å¦‚æœæ²¡æœ‰å†å²è®°å½•ï¼Œæ˜¾ç¤ºå‹å¥½æç¤º
   - "è¿˜æ²¡æœ‰å»å¹´çš„è®°å½•ï¼Œå¼€å§‹è®°å½•å§ï¼"

### 2.3 äº¤äº’è®¾è®¡

#### å±•å¼€/æŠ˜å 
- é»˜è®¤ï¼šæŠ˜å çŠ¶æ€ï¼Œåªæ˜¾ç¤ºæ ‡é¢˜å’Œæ•°é‡
- ç‚¹å‡»ï¼šå±•å¼€æ˜¾ç¤ºæ‰€æœ‰å†å²æ¡ç›®
- åŠ¨ç”»ï¼šå¹³æ»‘çš„å±•å¼€/æŠ˜å åŠ¨ç”»

#### å¹´ä»½åˆ†ç»„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“… å»å¹´ä»Šæ—¥                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â–¼ 1å¹´å‰ (2025å¹´1æœˆ12æ—¥) - 3æ¡     â”‚
â”‚    [å¡ç‰‡1] [å¡ç‰‡2] [å¡ç‰‡3]          â”‚
â”‚  â–¼ 2å¹´å‰ (2024å¹´1æœˆ12æ—¥) - 2æ¡     â”‚
â”‚    [å¡ç‰‡1] [å¡ç‰‡2]                  â”‚
â”‚  â–¼ 3å¹´å‰ (2023å¹´1æœˆ12æ—¥) - 1æ¡     â”‚
â”‚    [å¡ç‰‡1]                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å“åº”å¼è®¾è®¡
- **æ¡Œé¢ç«¯**ï¼šæ¨ªå‘æ’åˆ—ï¼Œæ¯è¡Œ2-3ä¸ªå¡ç‰‡
- **ç§»åŠ¨ç«¯**ï¼šçºµå‘æ’åˆ—ï¼Œæ¯ä¸ªå¡ç‰‡å…¨å®½
- **å¹³æ¿ç«¯**ï¼šæ ¹æ®å±å¹•å®½åº¦è‡ªé€‚åº”

### 2.4 UIç»„ä»¶è®¾è®¡

#### ç»„ä»¶1ï¼šå¹´ä»½æ ‡é¢˜æ 
```typescript
interface YearHeaderProps {
  year: number;        // å¹´ä»½
  count: number;       // æ¡ç›®æ•°é‡
  isExpanded: boolean; // æ˜¯å¦å±•å¼€
  onToggle: () => void;
}
```

#### ç»„ä»¶2ï¼šå†å²æ¡ç›®å¡ç‰‡
- å¤ç”¨ç°æœ‰çš„ `JournalCard` ç»„ä»¶
- æ·»åŠ å¹´ä»½æ ‡ç­¾
- æ·»åŠ "Xå¹´å‰"æ ‡è¯†

---

## ä¸‰ã€æ¶æ„è®¾è®¡

### 3.1 æ•°æ®æŸ¥è¯¢ç­–ç•¥

#### æ–¹æ¡ˆAï¼šå®æ—¶æŸ¥è¯¢ï¼ˆæ¨èï¼‰
```typescript
// åœ¨ loadEntries æ—¶åŒæ—¶æŸ¥è¯¢å†å²æ•°æ®
async loadOnThisDayEntries(): Promise<Map<number, JournalEntry[]>> {
  const today = new Date();
  const currentMonth = today.getMonth() + 1;
  const currentDay = today.getDate();
  
  const historyEntries = new Map<number, JournalEntry[]>();
  
  // æŸ¥è¯¢è¿‡å»Nå¹´çš„åŒæœˆåŒæ—¥æ•°æ®
  for (let yearOffset = 1; yearOffset <= MAX_YEARS; yearOffset++) {
    const targetYear = today.getFullYear() - yearOffset;
    const entries = this.entries.filter(entry => {
      const entryDate = entry.date;
      return entryDate.getMonth() + 1 === currentMonth &&
             entryDate.getDate() === currentDay &&
             entryDate.getFullYear() === targetYear;
    });
    
    if (entries.length > 0) {
      historyEntries.set(yearOffset, entries);
    }
  }
  
  return historyEntries;
}
```

#### æ–¹æ¡ˆBï¼šç´¢å¼•ä¼˜åŒ–
- åˆ›å»ºæ—¥æœŸç´¢å¼•ï¼š`Map<month-day, JournalEntry[]>`
- å¿«é€ŸæŸ¥æ‰¾åŒæœˆåŒæ—¥çš„æ¡ç›®
- éœ€è¦ç»´æŠ¤ç´¢å¼•çš„æ›´æ–°

**æ¨èï¼šæ–¹æ¡ˆA** - ç®€å•ç›´æ¥ï¼Œæ˜“äºç»´æŠ¤

### 3.2 æ€§èƒ½ä¼˜åŒ–

#### ä¼˜åŒ–ç­–ç•¥
1. **å»¶è¿ŸåŠ è½½**
   - "å»å¹´ä»Šæ—¥"åŒºåŸŸé»˜è®¤æŠ˜å 
   - åªåœ¨å±•å¼€æ—¶åŠ è½½æ•°æ®
   - ä½¿ç”¨æ‡’åŠ è½½ï¼ŒæŒ‰éœ€æ¸²æŸ“

2. **ç¼“å­˜æœºåˆ¶**
   - ç¼“å­˜æŸ¥è¯¢ç»“æœï¼ˆå½“å¤©æœ‰æ•ˆï¼‰
   - æ–‡ä»¶å˜åŒ–æ—¶æ¸…é™¤ç¼“å­˜
   - ä½¿ç”¨ `Map<date, entries>` ç»“æ„

3. **æ•°æ®é¢„è¿‡æ»¤**
   - åœ¨ `loadEntries` æ—¶æ ‡è®°æ—¥æœŸ
   - é¿å…é‡å¤éå†æ‰€æœ‰æ¡ç›®

#### å®ç°ç¤ºä¾‹
```typescript
class OnThisDayManager {
  private cache: Map<string, Map<number, JournalEntry[]>> = new Map();
  private cacheDate: string = '';
  
  getOnThisDayEntries(
    entries: JournalEntry[], 
    maxYears: number = 3
  ): Map<number, JournalEntry[]> {
    const today = new Date().toDateString();
    
    // æ£€æŸ¥ç¼“å­˜
    if (this.cacheDate === today && this.cache.has(today)) {
      return this.cache.get(today)!;
    }
    
    // è®¡ç®—å†å²æ¡ç›®
    const result = this.calculateOnThisDayEntries(entries, maxYears);
    
    // æ›´æ–°ç¼“å­˜
    this.cache.set(today, result);
    this.cacheDate = today;
    
    return result;
  }
  
  private calculateOnThisDayEntries(
    entries: JournalEntry[],
    maxYears: number
  ): Map<number, JournalEntry[]> {
    const today = new Date();
    const currentMonth = today.getMonth() + 1;
    const currentDay = today.getDate();
    
    const historyEntries = new Map<number, JournalEntry[]>();
    
    for (let yearOffset = 1; yearOffset <= maxYears; yearOffset++) {
      const targetYear = today.getFullYear() - yearOffset;
      const filtered = entries.filter(entry => {
        const d = entry.date;
        return d.getMonth() + 1 === currentMonth &&
               d.getDate() === currentDay &&
               d.getFullYear() === targetYear;
      });
      
      if (filtered.length > 0) {
        historyEntries.set(yearOffset, filtered);
      }
    }
    
    return historyEntries;
  }
  
  invalidateCache(): void {
    this.cache.clear();
    this.cacheDate = '';
  }
}
```

### 3.3 æ¨¡å—è®¾è®¡

#### æ¨¡å—ç»“æ„
```
OnThisDay/
â”œâ”€â”€ OnThisDayManager.ts      # æ ¸å¿ƒé€»è¾‘ï¼šæ•°æ®æŸ¥è¯¢å’Œç¼“å­˜
â”œâ”€â”€ OnThisDayRenderer.ts     # UIæ¸²æŸ“ï¼šå¡ç‰‡å’Œå¸ƒå±€
â””â”€â”€ OnThisDayTypes.ts        # ç±»å‹å®šä¹‰
```

#### ç±»è®¾è®¡
```typescript
// OnThisDayManager.ts
export class OnThisDayManager {
  getOnThisDayEntries(entries: JournalEntry[], maxYears: number): Map<number, JournalEntry[]>;
  invalidateCache(): void;
}

// OnThisDayRenderer.ts
export class OnThisDayRenderer {
  render(container: HTMLElement, historyEntries: Map<number, JournalEntry[]>): void;
  renderYearSection(yearOffset: number, entries: JournalEntry[]): HTMLElement;
}
```

### 3.4 é›†æˆç‚¹

#### åœ¨ JournalView ä¸­é›†æˆ
```typescript
// JournalView.ts
private onThisDayManager: OnThisDayManager;
private onThisDayRenderer: OnThisDayRenderer;

async loadEntries(): Promise<void> {
  // ... ç°æœ‰é€»è¾‘
  
  // åŠ è½½"å»å¹´ä»Šæ—¥"æ•°æ®
  const historyEntries = this.onThisDayManager.getOnThisDayEntries(
    this.entries,
    this.settings.maxHistoryYears || 3
  );
  
  this.historyEntries = historyEntries;
}

renderToContainer(container: HTMLElement): void {
  // ... ç°æœ‰æ¸²æŸ“é€»è¾‘
  
  // æ¸²æŸ“"å»å¹´ä»Šæ—¥"åŒºåŸŸ
  if (this.historyEntries.size > 0) {
    const onThisDayContainer = contentWrapper.createDiv('journal-on-this-day');
    this.onThisDayRenderer.render(onThisDayContainer, this.historyEntries);
  }
}
```

### 3.5 æ•°æ®æµ

```
ç”¨æˆ·æ‰“å¼€è§†å›¾
    â†“
loadEntries() - åŠ è½½æ‰€æœ‰æ¡ç›®
    â†“
OnThisDayManager.getOnThisDayEntries() - ç­›é€‰å†å²æ¡ç›®
    â†“
ç¼“å­˜ç»“æœï¼ˆå½“å¤©æœ‰æ•ˆï¼‰
    â†“
OnThisDayRenderer.render() - æ¸²æŸ“UI
    â†“
ç”¨æˆ·äº¤äº’ï¼ˆå±•å¼€/æŠ˜å ã€æŸ¥çœ‹è¯¦æƒ…ï¼‰
```

### 3.6 æ€§èƒ½è€ƒè™‘

#### æŸ¥è¯¢å¤æ‚åº¦
- **æ—¶é—´å¤æ‚åº¦**ï¼šO(n * m)
  - n: æ€»æ¡ç›®æ•°
  - m: æŸ¥è¯¢çš„å¹´ä»½æ•°ï¼ˆé€šå¸¸1-3å¹´ï¼‰
- **ç©ºé—´å¤æ‚åº¦**ï¼šO(k)
  - k: å†å²æ¡ç›®æ•°é‡ï¼ˆé€šå¸¸å¾ˆå°‘ï¼‰

#### ä¼˜åŒ–å»ºè®®
1. **ç´¢å¼•ä¼˜åŒ–**ï¼šä½¿ç”¨æ—¥æœŸç´¢å¼•åŠ é€ŸæŸ¥è¯¢
2. **åˆ†é¡µåŠ è½½**ï¼šå¦‚æœå†å²æ¡ç›®å¾ˆå¤šï¼Œæ”¯æŒåˆ†é¡µ
3. **è™šæ‹Ÿæ»šåŠ¨**ï¼šä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–æ¸²æŸ“æ€§èƒ½

---

## å››ã€å®ç°å»ºè®®

### 4.1 å®æ–½æ­¥éª¤

#### Phase 1: æ ¸å¿ƒåŠŸèƒ½
1. åˆ›å»º `OnThisDayManager` ç±»
2. å®ç°æ•°æ®æŸ¥è¯¢é€»è¾‘
3. æ·»åŠ ç¼“å­˜æœºåˆ¶

#### Phase 2: UIå®ç°
1. åˆ›å»º `OnThisDayRenderer` ç±»
2. å®ç°å¹´ä»½åˆ†ç»„å±•ç¤º
3. å®ç°å±•å¼€/æŠ˜å äº¤äº’

#### Phase 3: é›†æˆå’Œä¼˜åŒ–
1. é›†æˆåˆ° `JournalView`
2. æ·»åŠ é…ç½®é€‰é¡¹
3. æ€§èƒ½ä¼˜åŒ–å’Œæµ‹è¯•

### 4.2 é…ç½®é¡¹è®¾è®¡

```typescript
interface OnThisDaySettings {
  enabled: boolean;           // æ˜¯å¦å¯ç”¨
  maxYears: number;           // æœ€å¤šæ˜¾ç¤ºå¤šå°‘å¹´ï¼ˆ1-10ï¼‰
  matchPrecision: 'exact' | 'range'; // åŒ¹é…ç²¾åº¦
  rangeDays: number;          // èŒƒå›´åŒ¹é…çš„å¤©æ•°ï¼ˆÂ±Nå¤©ï¼‰
  maxEntriesPerYear: number;  // æ¯å¹´æœ€å¤šæ˜¾ç¤ºå¤šå°‘æ¡
  autoExpand: boolean;        // æ˜¯å¦é»˜è®¤å±•å¼€
}
```

### 4.3 è¾¹ç•Œæƒ…å†µå¤„ç†

1. **æ— å†å²è®°å½•**
   - æ˜¾ç¤ºå‹å¥½æç¤º
   - ä¸æ˜¾ç¤º"å»å¹´ä»Šæ—¥"åŒºåŸŸ

2. **æ—¥æœŸè¾¹ç•Œ**
   - å¤„ç†é—°å¹´2æœˆ29æ—¥çš„æƒ…å†µ
   - å¤„ç†æ—¶åŒºé—®é¢˜

3. **å¤§é‡å†å²è®°å½•**
   - é™åˆ¶æ˜¾ç¤ºæ•°é‡
   - æ”¯æŒ"æŸ¥çœ‹æ›´å¤š"

---

## äº”ã€å‚è€ƒæ¡ˆä¾‹

### 5.1 ç±»ä¼¼äº§å“

1. **Facebook "On This Day"**
   - æ˜¾ç¤ºè¿‡å»åŒä¸€å¤©çš„ç…§ç‰‡å’ŒåŠ¨æ€
   - æ”¯æŒå¤šå¹´å†å²
   - å¡ç‰‡å¼å±•ç¤º

2. **Apple Photos "Memories"**
   - è‡ªåŠ¨ç”Ÿæˆå›å¿†ç›¸å†Œ
   - æŒ‰æ—¥æœŸåŒ¹é…
   - ç²¾ç¾çš„è§†è§‰è®¾è®¡

3. **Day One æ—¥è®°åº”ç”¨**
   - "On This Day"åŠŸèƒ½
   - æ˜¾ç¤ºå¤šå¹´å†å²
   - æ”¯æŒå¯¹æ¯”æŸ¥çœ‹

### 5.2 è®¾è®¡çµæ„Ÿ

- **æ—¶é—´è½´è®¾è®¡**ï¼šå‚ç›´æ—¶é—´è½´å±•ç¤ºå¤šå¹´å†å²
- **å¡ç‰‡æµ**ï¼šç±»ä¼¼ä¸»åˆ—è¡¨çš„å¡ç‰‡å±•ç¤º
- **å¯¹æ¯”è§†å›¾**ï¼šå¹¶æ’æ˜¾ç¤ºä¸åŒå¹´ä»½çš„åŒä¸€å¤©

---

## å…­ã€æŠ€æœ¯å®ç°ç»†èŠ‚

### 6.1 æ—¥æœŸåŒ¹é…ç®—æ³•

#### ç²¾ç¡®åŒ¹é…å®ç°
```typescript
function isSameMonthDay(date1: Date, date2: Date): boolean {
  return date1.getMonth() === date2.getMonth() &&
         date1.getDate() === date2.getDate();
}

function getYearOffset(date1: Date, date2: Date): number {
  return date1.getFullYear() - date2.getFullYear();
}
```

#### èŒƒå›´åŒ¹é…å®ç°
```typescript
function isWithinRange(date1: Date, date2: Date, rangeDays: number): boolean {
  const diff = Math.abs((date1.getTime() - date2.getTime()) / (1000 * 60 * 60 * 24));
  return diff <= rangeDays && isSameMonthDay(date1, date2);
}
```

### 6.2 æ•°æ®ç»“æ„è®¾è®¡

```typescript
interface OnThisDayEntry {
  yearOffset: number;      // å¹´ä»½åç§»ï¼ˆ1=å»å¹´ï¼Œ2=å‰å¹´ï¼‰
  year: number;            // å…·ä½“å¹´ä»½
  entries: JournalEntry[]; // è¯¥å¹´ä»½çš„æ¡ç›®åˆ—è¡¨
}

interface OnThisDayData {
  today: Date;                           // ä»Šå¤©çš„æ—¥æœŸ
  historyEntries: Map<number, JournalEntry[]>; // æŒ‰å¹´ä»½åç§»åˆ†ç»„
  totalCount: number;                    // æ€»æ¡ç›®æ•°
}
```

### 6.3 UIç»„ä»¶ç»“æ„

```html
<div class="journal-on-this-day">
  <div class="journal-on-this-day-header">
    <h2>ğŸ“… å»å¹´ä»Šæ—¥</h2>
    <button class="journal-toggle-all">å±•å¼€å…¨éƒ¨</button>
  </div>
  
  <div class="journal-on-this-day-content">
    <!-- 1å¹´å‰ -->
    <div class="journal-year-section" data-year-offset="1">
      <div class="journal-year-header">
        <span class="journal-year-label">1å¹´å‰ (2025å¹´1æœˆ12æ—¥)</span>
        <span class="journal-year-count">3æ¡</span>
        <button class="journal-year-toggle">â–¼</button>
      </div>
      <div class="journal-year-entries">
        <!-- å¡ç‰‡åˆ—è¡¨ -->
      </div>
    </div>
    
    <!-- 2å¹´å‰ -->
    <!-- ... -->
  </div>
</div>
```

### 6.4 CSSæ ·å¼è®¾è®¡

```css
.journal-on-this-day {
  margin: 24px 0;
  padding: 20px;
  background: #ffffff;
  border-radius: 12px;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.journal-on-this-day-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.journal-year-section {
  margin-bottom: 16px;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  overflow: hidden;
}

.journal-year-header {
  display: flex;
  align-items: center;
  padding: 12px 16px;
  background: #f5f5f5;
  cursor: pointer;
  user-select: none;
}

.journal-year-entries {
  padding: 16px;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 16px;
}

.journal-year-entries.collapsed {
  display: none;
}
```

### 6.5 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### 1. ç´¢å¼•æ„å»º
```typescript
// æ„å»ºæ—¥æœŸç´¢å¼•ï¼ŒåŠ é€ŸæŸ¥è¯¢
private buildDateIndex(entries: JournalEntry[]): Map<string, JournalEntry[]> {
  const index = new Map<string, JournalEntry[]>();
  
  for (const entry of entries) {
    const date = entry.date;
    const key = `${date.getMonth() + 1}-${date.getDate()}`; // "1-12"
    
    if (!index.has(key)) {
      index.set(key, []);
    }
    index.get(key)!.push(entry);
  }
  
  return index;
}
```

#### 2. æ‡’åŠ è½½å®ç°
```typescript
// åªåœ¨å±•å¼€æ—¶åŠ è½½æ•°æ®
private async loadYearEntries(yearOffset: number): Promise<JournalEntry[]> {
  if (this.yearEntriesCache.has(yearOffset)) {
    return this.yearEntriesCache.get(yearOffset)!;
  }
  
  const entries = await this.queryYearEntries(yearOffset);
  this.yearEntriesCache.set(yearOffset, entries);
  return entries;
}
```

### 6.6 é”™è¯¯å¤„ç†

```typescript
try {
  const historyEntries = await this.onThisDayManager.getOnThisDayEntries(
    this.entries,
    this.settings.maxHistoryYears
  );
  
  if (historyEntries.size === 0) {
    this.renderEmptyState(container);
    return;
  }
  
  this.onThisDayRenderer.render(container, historyEntries);
} catch (error) {
  logger.error('åŠ è½½"å»å¹´ä»Šæ—¥"æ•°æ®å¤±è´¥:', error);
  this.renderErrorState(container, error);
}
```

## ä¸ƒã€æ€»ç»“

### 6.1 æ ¸å¿ƒè¦ç‚¹

1. **åŠŸèƒ½ä»·å€¼**ï¼šå¸®åŠ©ç”¨æˆ·å›é¡¾å†å²ï¼Œå¢å¼ºæƒ…æ„Ÿè¿æ¥
2. **å®ç°å¤æ‚åº¦**ï¼šä¸­ç­‰ï¼Œä¸»è¦æ˜¯æ•°æ®æŸ¥è¯¢å’ŒUIæ¸²æŸ“
3. **æ€§èƒ½å½±å“**ï¼šè¾ƒå°ï¼Œé€šè¿‡ç¼“å­˜å’Œå»¶è¿ŸåŠ è½½ä¼˜åŒ–

### 6.2 æ¨èæ–¹æ¡ˆ

- **å±•ç¤ºä½ç½®**ï¼šç‹¬ç«‹åŒºåŸŸï¼Œåœ¨ç»Ÿè®¡ä¿¡æ¯ä¸‹æ–¹
- **æ•°æ®æŸ¥è¯¢**ï¼šå®æ—¶æŸ¥è¯¢ + ç¼“å­˜æœºåˆ¶
- **UIè®¾è®¡**ï¼šå¹´ä»½åˆ†ç»„ï¼Œå¯å±•å¼€/æŠ˜å 
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå»¶è¿ŸåŠ è½½ + ç¼“å­˜ + ç´¢å¼•

### 6.3 ä¸‹ä¸€æ­¥

1. ç¡®è®¤åŠŸèƒ½éœ€æ±‚ç»†èŠ‚
2. è®¾è®¡UIåŸå‹
3. å®ç°æ ¸å¿ƒé€»è¾‘
4. é›†æˆå’Œæµ‹è¯•
